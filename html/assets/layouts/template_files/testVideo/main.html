<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>%%PAGE_TITLE%%</title>

        <!-- {{javascript=external/popper.min.js}}
        {{javascript=external/bootstrap.min.js}}

        {{stylesheet=external/bootstrap.min.css}}
        <link href="https://unpkg.com/@videojs/themes@1/dist/forest/index.css" rel="stylesheet">

        <style>
            .vjs-playlist {
                width: 50%;
                padding: 0;
                background-color: #1a1a1a;
                color: #fff;
                list-style-type: none;
            }

            .vjs-playlist.vjs-playlist-horizontal {
                float: none;
                height: 120px;
                width: 740px;

            }

            .vjs-playlist-horizontal .vjs-playlist-item {
                display: inline-block;
                height: 100%;
                margin-right: 5px;
            }

            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
                display: flex;
                flex-direction: column;
                align-items: center;
                background-color: #f4f4f4;
            }

            .controls {
                margin-top: 20px;
                display: flex;
                gap: 10px;
            }

            button {
                background-color: #007bff;
                color: white;
                border: none;
                padding: 10px 15px;
                cursor: pointer;
                border-radius: 5px;
                font-size: 16px;
            }

            button:hover {
                background-color: #0056b3;
            }

            .playlist-info {
                margin-top: 20px;
                background-color: #fff;
                padding: 15px;
                border-radius: 5px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

            ul {
                list-style: none;
                padding: 0;
            }

            a {
                color: #007bff;
                text-decoration: none;
            }

            a:hover {
                text-decoration: underline;
            }

            .playlist-display {
                margin-top: 20px;
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
            }

            .playlist-item {
                border: 1px solid #ddd;
                border-radius: 5px;
                padding: 10px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                background-color: #fff;
            }

            .playlist-item:hover {
                background-color: #007bff;
            }

            .playlist-item img {
                max-width: 100px;
                height: auto;
                border-radius: 5px;
            }

            .playlist-item p {
                margin: 5px 0 0;
                font-size: 14px;
            }

            .input-group {
                margin-top: 10px;
            }

            input[type="number"] {
                padding: 10px;
                border-radius: 5px;
                border: 1px solid #ddd;
                width: 50px;
            }
        </style>
    </head>

    <body>


        <!-- <video-js data-setup='{}' controls></video-js> -->
        <video id="videojs-playlist-player" class="video-js vjs-default-skin" controls width="740" height="680">
            <source src="%%VIDEO_URL%%" type="video/mp4" id="VideoFile">
            </source>
        </video>
        <div class="controls">
            <button id="prevBtn">Previous</button>
            <button id="nextBtn">Next</button>
            <button id="firstBtn">First</button>
            <button id="lastBtn">Last</button>
            <button id="addBtn">Add</button>
            <button id="removeBtn">Remove</button>
            <button id="reverseBtn">Reverse</button>
            <button id="sortBtn">Sort</button>
            <button id="shuffleBtn">Shuffle</button>
        </div>

        <div class="input-group">
            <label for="removeIndexInput">Remove from index:</label>
            <input id="removeIndexInput" type="number" value="0" min="0">

            <label for="removeCountInput">Number of items to remove:</label>
            <input id="removeCountInput" type="number" value="1" min="0">

            <label for="addIndexInput">Index to add item:</label>
            <input id="addIndexInput" type="number" value="0" min="0">
        </div>

        <!-- Playlist Information -->
        <div id="playlistInfo" class="playlist-info">
            Current Index: <span id="currentIndex">-</span><br>
            Next Index: <span id="nextIndex">-</span><br>
            Previous Index: <span id="prevIndex">-</span><br>
            Last Index: <span id="lastIndex">-</span><br>
            Repeat: <span id="repeat">-</span><br>
            Autoadvance Delay: <span id="autoadvance">-</span>
        </div>

        <!-- Playlist Display -->
        <div id="playlistDisplay" class="playlist-display">
            <!-- Playlist items will be added here dynamically -->
        </div>


        </div>





        %%SCRIPTS%%


        <script>
            // Initialize the player
            const player = videojs('videojs-playlist-player');

            // const player = videojs(document.querySelector('video-js'));
            // Initialize the plugin and render the playlist
            //  var player = videojs('videojs');
            player.on([
                'playlistchange', 'playlistsorted',
                'beforeplaylistitem', 'playlistitem',
                'playlistadd', 'playlistremove'
            ], (e, data) => {
                console.log('player saw "' + e.type + '"', e);
                console.log('event data:', data);
            });
            //const playlistPlugin = player.playlistPlugin;
            const playlistPlugin = player.playlistPlugin(player, {});

            const PlaylistPluginClass = videojs.getPlugin('playlistPlugin');

            const videoList = [

                !!PLAYLIST!!

            ];

            const playlist = PlaylistPluginClass.createPlaylistFrom(videoList);
            player.playlist.autoadvance(0);
            // Playlist methods
            playlist.shuffle();
            playlist.enableRepeat();

            // Plugin methods
            // playlistPlugin.loadPlaylist(playlist);
            // playlistPlugin.loadFirstItem();
            // playlistPlugin.setAutoadvanceDelay(0);

            // Update Playlist Information
            function updatePlaylistInfo() {
                document.getElementById('currentIndex').textContent = playlist.getCurrentIndex();
                document.getElementById('lastIndex').textContent = playlist.getLastIndex();
                document.getElementById('nextIndex').textContent = playlist.getNextIndex();
                document.getElementById('prevIndex').textContent = playlist.getPreviousIndex();
                document.getElementById('repeat').textContent = playlist.isRepeatEnabled();
                document.getElementById('autoadvance').textContent = playlistPlugin.getAutoadvanceDelay();
            }

            // Update the Playlist Display UI
            function updatePlaylistDisplay() {
                const display = document.getElementById('playlistDisplay');

                display.innerHTML = '';

                playlist.get().forEach(function (item, index) {
                    const itemDiv = document.createElement('div');

                    itemDiv.classList.add('playlist-item');

                    itemDiv.addEventListener('click', function () {
                        playlistPlugin.loadPlaylistItem(index);
                        updatePlaylistInfo();
                    });

                    const img = document.createElement('img');

                    img.src = item.poster || 'placeholder.jpg';
                    itemDiv.appendChild(img);

                    const title = document.createElement('p');

                    title.textContent = `Item ${index + 1}`;
                    itemDiv.appendChild(title);

                    display.appendChild(itemDiv);
                });
            }

            // Initial calls
            updatePlaylistDisplay();
            updatePlaylistInfo();

            player.on(['playlistchange', 'playlistsorted', 'playlistadd', 'playlistremove', 'playlistitem'], () => {
                updatePlaylistDisplay();
                updatePlaylistInfo();
            });

            // Control Button Event Listeners
            const controls = document.querySelector('.controls');

            controls.addEventListener('click', function (event) {
                const buttonId = event.target.id;

                switch (buttonId) {
                    case 'prevBtn':
                        //   playlistPlugin.loadPreviousItem();
                        break;
                    case 'nextBtn':
                        //   playlistPlugin.loadNextItem();
                        break;
                    case 'firstBtn':
                        //   playlistPlugin.loadFirstItem();
                        break;
                    case 'lastBtn':
                        //   playlistPlugin.loadLastItem();
                        break;
                    case 'addBtn':
                        const addIndex = parseInt(document.getElementById('addIndexInput').value, 10);

                        // Add the same source URL but with a different poster so it is possible to differentiate
                        const added = playlist.add({
                            sources: [{ src: 'http://vjs.zencdn.net/v/oceans.mp4', type: 'video/mp4' }],
                            poster: `https://image.mux.com/5g1hMA6dKAe8DCgBB901DYB200U65ev2y00/thumbnail.jpg?time=${Math.floor(Math.random() * 30) + 1}`
                        }, addIndex);
                        videojs.log('added items:', added);
                        break;
                    case 'removeBtn':
                        const removeIndex = parseInt(document.getElementById('removeIndexInput').value, 10);
                        const removeCount = parseInt(document.getElementById('removeCountInput').value, 10);
                        const removed = playlist.remove(removeIndex, removeCount);

                        videojs.log('removed items:', removed);
                        break;
                    case 'reverseBtn':
                        //   playlist.reverse();
                        break;
                    case 'sortBtn':
                        //   playlist.sort((a, b) => a.sources[0].src.localeCompare(b.sources[0].src));
                        break;
                    case 'shuffleBtn':
                        //   playlist.shuffle();
                        break;
                }
            });
            // player.playlistUi({ horizontal: true });

            // Play through the playlist automatically.
            // player.playlist.autoadvance(0)
        </script>
    </body>

</html>